{% extends 'base.html' %}
{% load static %}

{% block title %}Profile - Aura{% endblock %}

{% block content %}
<div class="container pt-6">
    {% if messages %}
    <div style="max-width: 800px; margin: 0 auto 1.5rem;">
        {% for message in messages %}
        <div
            style="padding: 0.8rem 1.2rem; border-radius: 8px; font-size: 0.9rem; margin-bottom: 0.5rem;
            {% if message.tags == 'error' %}background: rgba(229,9,20,0.15); color: #ff4444; border: 1px solid rgba(229,9,20,0.3);
            {% elif message.tags == 'success' %}background: rgba(46,204,113,0.15); color: #2ecc71; border: 1px solid rgba(46,204,113,0.3);
            {% else %}background: rgba(52,152,219,0.15); color: #3498db; border: 1px solid rgba(52,152,219,0.3);{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="row" style="display: flex; gap: 2rem; flex-wrap: wrap; max-width: 800px; margin: 0 auto;">
        <!-- Left Side: User Info & Avatar -->
        <div style="flex: 1; min-width: 280px;">
            <div style="background: rgba(0,0,0,0.5); padding: 2rem; border-radius: 12px; border: 1px solid #333;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <!-- Avatar with upload -->
                    <div style="position: relative; display: inline-block;">
                        {% if user_profile and user_profile.avatar %}
                        <img src="{{ user_profile.avatar.url }}" alt="{{ user.username }}"
                            style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #e50914;">
                        {% else %}
                        <div
                            style="width: 120px; height: 120px; background: #e50914; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto; font-weight: 700; border: 3px solid #e50914;">
                            {{ user.username|first|upper }}
                        </div>
                        {% endif %}

                        <!-- Camera upload button -->
                        <form method="post" enctype="multipart/form-data" id="avatar-form"
                            style="position: absolute; bottom: 0; right: 0;">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="avatar">
                            <input type="file" name="avatar" id="avatar-input" accept="image/*" style="display: none;"
                                onchange="document.getElementById('avatar-form').submit();">
                            <label for="avatar-input"
                                style="width: 36px; height: 36px; background: #e50914; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid #141414; transition: transform 0.2s;"
                                onmouseover="this.style.transform='scale(1.1)'"
                                onmouseout="this.style.transform='scale(1)'">
                                <i class="fas fa-camera" style="color: white; font-size: 0.85rem;"></i>
                            </label>
                        </form>
                    </div>

                    <h2 style="margin-top: 1rem; font-size: 1.5rem;">{{ user.username }}</h2>
                    <p style="color: #bbb; font-size: 0.9rem;">Member since {{ user.date_joined|date:"F Y" }}</p>
                </div>

                <hr style="border-color: #333; margin: 1.5rem 0;">

                <!-- Stats -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: center;">
                    <div>
                        <h3 style="font-size: 2rem; font-weight: 700; color: white;">{{ watchlist_count }}</h3>
                        <p style="color: #bbb; font-size: 0.85rem;">Movies in List</p>
                    </div>
                    <div>
                        <a href="{% url 'watchlist' %}" style="text-decoration: none;">
                            <div class="btn btn-secondary" style="padding: 0.6rem 1rem; font-size: 0.85rem;">
                                <i class="fas fa-list"></i> View Watchlist
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Side: Edit Profile -->
        <div style="flex: 2; min-width: 300px;">
            <!-- Edit Details -->
            <div
                style="background: rgba(0,0,0,0.5); padding: 2rem; border-radius: 12px; border: 1px solid #333; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem;">
                    <i class="fas fa-user-edit" style="color: #e50914; margin-right: 0.5rem;"></i> Edit Profile
                </h3>

                <form method="post" action="{% url 'profile' %}">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="profile">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; color: #bbb; font-size: 0.85rem; margin-bottom: 0.4rem;">First
                                Name</label>
                            <input type="text" name="first_name" value="{{ user.first_name }}" class="form-control"
                                placeholder="First Name">
                        </div>
                        <div>
                            <label style="display: block; color: #bbb; font-size: 0.85rem; margin-bottom: 0.4rem;">Last
                                Name</label>
                            <input type="text" name="last_name" value="{{ user.last_name }}" class="form-control"
                                placeholder="Last Name">
                        </div>
                    </div>

                    <div style="margin-bottom: 1rem;">
                        <label
                            style="display: block; color: #bbb; font-size: 0.85rem; margin-bottom: 0.4rem;">Email</label>
                        <input type="email" name="email" value="{{ user.email }}" class="form-control"
                            placeholder="Email" required>
                    </div>

                    {% if profile_form.errors %}
                    <div
                        style="padding: 0.6rem; margin-bottom: 1rem; border-radius: 8px; background: rgba(229,9,20,0.15); color: #ff4444; border: 1px solid rgba(229,9,20,0.3); font-size: 0.85rem;">
                        {% for field in profile_form %}
                        {% for error in field.errors %}
                        <p>{{ error }}</p>
                        {% endfor %}
                        {% endfor %}
                    </div>
                    {% endif %}

                    <button type="submit" class="btn btn-primary" style="padding: 0.6rem 1.5rem;">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </form>
            </div>

            <!-- Change Password -->
            <div style="background: rgba(0,0,0,0.5); padding: 2rem; border-radius: 12px; border: 1px solid #333;">
                <h3 style="font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem;">
                    <i class="fas fa-lock" style="color: #e50914; margin-right: 0.5rem;"></i> Change Password
                </h3>

                <form method="post" action="{% url 'profile' %}">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="password">

                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; color: #bbb; font-size: 0.85rem; margin-bottom: 0.4rem;">Current
                            Password</label>
                        <input type="password" name="old_password" class="form-control" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; color: #bbb; font-size: 0.85rem; margin-bottom: 0.4rem;">New
                                Password</label>
                            <input type="password" name="new_password1" class="form-control" required>
                        </div>
                        <div>
                            <label
                                style="display: block; color: #bbb; font-size: 0.85rem; margin-bottom: 0.4rem;">Confirm
                                Password</label>
                            <input type="password" name="new_password2" class="form-control" required>
                        </div>
                    </div>

                    {% if password_form.errors %}
                    <div
                        style="padding: 0.6rem; margin-bottom: 1rem; border-radius: 8px; background: rgba(229,9,20,0.15); color: #ff4444; border: 1px solid rgba(229,9,20,0.3); font-size: 0.85rem;">
                        {% for field in password_form %}
                        {% for error in field.errors %}
                        <p>{{ error }}</p>
                        {% endfor %}
                        {% endfor %}
                        {% for error in password_form.non_field_errors %}
                        <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <button type="submit" class="btn btn-secondary" style="padding: 0.6rem 1.5rem;">
                        <i class="fas fa-key"></i> Update Password
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}