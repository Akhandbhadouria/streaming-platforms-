{% extends 'base.html' %}
{% load static %}

{% block title %}Profile - Aura{% endblock %}

{% block content %}
<style>
    .profile-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 100px 1rem 2rem 1rem;
        font-family: 'Inter', -apple-system, sans-serif;
        color: #fff;
    }

    .profile-header-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 3rem;
    }

    .profile-title {
        display: flex;
        align-items: center;
        font-size: 1.4rem;
        font-weight: 500;
        letter-spacing: 0.5px;
    }

    .title-indicator {
        width: 4px;
        height: 24px;
        background-color: #55efc4;
        border-radius: 4px;
        margin-right: 12px;
    }

    .header-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .dropdown-btn {
        background: transparent;
        border: 1px solid #444;
        color: #ddd;
        padding: 0.6rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
    }

    .download-btn {
        background-color: #55efc4;
        color: #000;
        border: none;
        padding: 0.6rem 1.2rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.9rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: opacity 0.2s;
    }

    .download-btn:hover {
        opacity: 0.9;
    }

    /* Profile Details Section */
    .user-info-section {
        display: flex;
        align-items: center;
        gap: 2.5rem;
        margin-bottom: 2.5rem;
    }

    .avatar-wrapper {
        position: relative;
    }

    .avatar-wrapper img,
    .avatar-wrapper .avatar-placeholder {
        width: 110px;
        height: 110px;
        border-radius: 50%;
        object-fit: cover;
    }

    .avatar-placeholder {
        background: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        font-weight: 700;
    }

    .user-details h2 {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 1.2rem;
        margin-top: 0;
    }

    .user-meta {
        display: flex;
        gap: 3.5rem;
    }

    .meta-group label {
        display: block;
        color: #888;
        font-size: 0.85rem;
        margin-bottom: 0.3rem;
    }

    .meta-group p {
        margin: 0;
        font-size: 1.05rem;
        font-weight: 500;
        color: #eaeaea;
    }

    /* Stats Cards */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.2rem;
        margin-bottom: 3.5rem;
    }

    .stat-card {
        background: #282828;
        border-radius: 12px;
        padding: 1.2rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .stat-icon {
        width: 44px;
        height: 44px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.08);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #bbb;
        font-size: 1.1rem;
    }

    .stat-info .stat-value {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0 0 0.2rem 0;
        color: #fff;
    }

    .stat-info .stat-label {
        color: #888;
        font-size: 0.8rem;
        margin: 0;
    }

    /* Edit Forms Section */
    .forms-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }

    .form-card {
        background: #1c1c1c;
        border-radius: 12px;
        padding: 2rem;
        border: 1px solid #333;
    }

    .form-card h3 {
        margin-top: 0;
        margin-bottom: 1.5rem;
        font-size: 1.1rem;
        color: #eee;
        display: flex;
        align-items: center;
    }

    .form-control-dark {
        background: #2a2a2a;
        border: 1px solid #444;
        color: white;
        padding: 0.6rem 1rem;
        border-radius: 8px;
        width: 100%;
        margin-bottom: 1rem;
        font-size: 0.9rem;
    }

    .form-control-dark:focus {
        outline: none;
        border-color: #55efc4;
    }

    .form-label {
        display: block;
        color: #aaa;
        font-size: 0.85rem;
        margin-bottom: 0.4rem;
    }

    .btn-action {
        background: #333;
        color: white;
        border: none;
        padding: 0.6rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .btn-action:hover {
        background: #444;
    }

    .btn-primary-action {
        background: #e50914;
        color: white;
        border: none;
        padding: 0.6rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.2s;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .btn-primary-action:hover {
        background: #f40612;
    }

    /* Make it responsive */
    @media (max-width: 900px) {
        .stats-grid {
            grid-template-columns: 1fr 1fr;
        }

        .forms-grid {
            grid-template-columns: 1fr;
        }

        .user-info-section {
            flex-direction: column;
            align-items: flex-start;
            gap: 1.5rem;
        }

        .user-meta {
            flex-direction: column;
            gap: 1rem;
        }
    }
</style>

<div class="profile-container">
    {% if messages %}
    <div style="margin-bottom: 1.5rem;">
        {% for message in messages %}
        <div
            style="padding: 0.8rem 1.2rem; border-radius: 8px; font-size: 0.9rem; margin-bottom: 0.5rem;
            {% if message.tags == 'error' %}background: rgba(229,9,20,0.15); color: #ff4444; border: 1px solid rgba(229,9,20,0.3);
            {% elif message.tags == 'success' %}background: rgba(46,204,113,0.15); color: #2ecc71; border: 1px solid rgba(46,204,113,0.3);
            {% else %}background: rgba(52,152,219,0.15); color: #3498db; border: 1px solid rgba(52,152,219,0.3);{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Top Bar -->
    <div class="profile-header-bar">

        <div class="header-actions">


        </div>
    </div>

    <!-- User Profile Info -->
    <div class="user-info-section">
        <div class="avatar-wrapper">
            {% if user_profile and user_profile.avatar %}
            <img src="{{ user_profile.avatar.url }}" alt="{{ user.username }}">
            {% else %}
            <div class="avatar-placeholder">
                {{ user.username|first|upper }}
            </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data" id="avatar-form"
                style="position: absolute; bottom: 0; right: 0;">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="avatar">
                <input type="file" name="avatar" id="avatar-input" accept="image/*" style="display: none;"
                    onchange="document.getElementById('avatar-form').submit();">
                <label for="avatar-input"
                    style="width: 34px; height: 34px; background: #282828; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid #151515; color: white;">
                    <i class="fas fa-camera" style="font-size: 0.8rem;"></i>
                </label>
            </form>
        </div>

        <div class="user-details">
            <h2>{{ user.first_name|default:user.username }} {{ user.last_name|default:"" }}</h2>
            <div class="user-meta">
                <div class="meta-group">
                    <label>Role</label>
                    <p>{% if user.is_staff %}Administrator{% else %}Member{% endif %}</p>
                </div>
                <div class="meta-group">
                    <label>Member Since</label>
                    <p>{{ user.date_joined|date:"M d, Y" }}</p>
                </div>
                <div class="meta-group">
                    <label>Email Address</label>
                    <p>{{ user.email }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Row -->
    <br>

    <!-- Forms Row -->
    <div class="forms-grid">
        <!-- Edit Profile Form -->
        <div class="form-card">
            <h3></i> Edit Profile</h3>
            <form method="post" action="{% url 'profile' %}">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="profile">

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label class="form-label">First Name</label>
                        <input type="text" name="first_name" value="{{ user.first_name }}" class="form-control-dark"
                            placeholder="First Name">
                    </div>
                    <div>
                        <label class="form-label">Last Name</label>
                        <input type="text" name="last_name" value="{{ user.last_name }}" class="form-control-dark"
                            placeholder="Last Name">
                    </div>
                </div>

                <div>
                    <label class="form-label">Email</label>
                    <input type="email" name="email" value="{{ user.email }}" class="form-control-dark"
                        placeholder="Email" required>
                </div>

                {% if profile_form.errors %}
                <div
                    style="padding: 0.6rem; margin-bottom: 1rem; border-radius: 8px; background: rgba(229,9,20,0.15); color: #ff4444; border: 1px solid rgba(229,9,20,0.3); font-size: 0.85rem;">
                    {% for field in profile_form %}
                    {% for error in field.errors %}
                    <p style="margin: 0;">{{ error }}</p>
                    {% endfor %}
                    {% endfor %}
                </div>
                {% endif %}

                <button type="submit" class="btn-primary-action" style="margin-top: 0.5rem;">
                    Save Changes
                </button>
            </form>
        </div>

        <!-- Change Password Form -->
        <div class="form-card">
            <h3> Change Password</h3>
            <form method="post" action="{% url 'profile' %}">
                {% csrf_token %}
                <input type="hidden" name="form_type" value="password">

                <div>
                    <label class="form-label">Current Password</label>
                    <input type="password" name="old_password" class="form-control-dark" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label class="form-label">New Password</label>
                        <input type="password" name="new_password1" class="form-control-dark" required>
                    </div>
                    <div>
                        <label class="form-label">Confirm Password</label>
                        <input type="password" name="new_password2" class="form-control-dark" required>
                    </div>
                </div>

                {% if password_form.errors %}
                <div
                    style="padding: 0.6rem; margin-bottom: 1rem; border-radius: 8px; background: rgba(229,9,20,0.15); color: #ff4444; border: 1px solid rgba(229,9,20,0.3); font-size: 0.85rem;">
                    {% for field in password_form %}
                    {% for error in field.errors %}
                    <p style="margin: 0;">{{ error }}</p>
                    {% endfor %}
                    {% endfor %}
                    {% for error in password_form.non_field_errors %}
                    <p style="margin: 0;">{{ error }}</p>
                    {% endfor %}
                </div>
                {% endif %}

                <button type="submit" class="btn-action" style="margin-top: 0.5rem;">
                    Update Password
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}